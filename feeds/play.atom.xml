<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>A Ordinary Boy, A Marvelous Toy</title><link href="http://blog.cosmoslx.me/" rel="alternate"></link><link href="http://blog.cosmoslx.me/feeds/play.atom.xml" rel="self"></link><id>http://blog.cosmoslx.me/</id><updated>2012-02-04T15:23:00+08:00</updated><entry><title>小v的sleep掉电bug根本原因分析和解决</title><link href="http://blog.cosmoslx.me/veer-sleep-bug.html" rel="alternate"></link><updated>2012-02-04T15:23:00+08:00</updated><author><name>cosmoslx</name></author><id>tag:blog.cosmoslx.me,2012-02-04:veer-sleep-bug.html</id><summary type="html">&lt;p&gt;hi~各位机油,龙年快乐啊,从2011年的圣诞的那天开始我拥抱veer,走上webos之路,各位煮机网的机油都给我提供了大量的帮助,现在是我小小贡献的时候了.废话不多说,进入正题.&lt;/p&gt;
&lt;!-- more --&gt;

&lt;h1&gt;sleep掉电bug&lt;/h1&gt;
&lt;p&gt;简单回顾一下所谓的sleep掉电bug及如何判断是否你的小v有掉电bug呢.&lt;/p&gt;
&lt;h2&gt;什么是sleep掉电bug&lt;/h2&gt;
&lt;p&gt;回顾一下所谓的&lt;a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;amp;tid=85588&amp;amp;fromuid=230125"&gt;sleep掉电bug&lt;/a&gt;指的是&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;webos设备有过待机突然掉电的情况，通过刷机和reboot解决，就是可能有sleep bug，即设备不能正常sleep
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;通常如果你的veer充满电并在晚上睡觉时开启飞行模式一般早上起来会消损2%~3%的电,&amp;nbsp;而如果有你的veer消损20%~30%的电量,那么很可能就是掉电bug.&lt;/p&gt;
&lt;h2&gt;判断标准及方法&lt;/h2&gt;
&lt;p&gt;使用sdlterminal,详细&lt;a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;amp;tid=85588&amp;amp;fromuid=230125"&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;1.在preware中安装sdlterminal这个软件；
2.在非充电的状态下运行sdlterminal，单击电源键，15秒后再单击电源键；
3.查看sdlterminal上的powerd信息，正常情况sdlterminal会记录两个时间信息，一个是你第一次按电源键的时间，另一个是第二次按电源键的时间；
4.如果出现很多system go to sleep now 和 system woke up，就说明你的设备存在sleep&amp;nbsp;bug。&lt;/p&gt;
&lt;h1&gt;引起sleep掉电bug的原因分析&lt;/h1&gt;
&lt;p&gt;有很多相关的帖子分析了掉电bug的原因,有的人认为是硬件的问题,有的人认为是rom的问题,在这里我就不多描述了.&amp;nbsp;这里开始描述一下我发现的sleep掉电的原因的经过.&lt;/p&gt;
&lt;p&gt;可能大家开始入手veer的时候而且如果是动感地带的卡的话都会遇到过这样的问题:
&lt;a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;amp;tid=94264&amp;amp;fromuid=230125"&gt;为甚么我的&lt;span class="caps"&gt;VEER&lt;/span&gt;装上动感地带的卡后老是出现“&lt;span class="caps"&gt;SIM&lt;/span&gt;卡服务”的字样&lt;/a&gt;
我和我&lt;span class="caps"&gt;GF&lt;/span&gt;一起买的veer,她的就不会,而我的就经常弹出,于是按照上面&lt;a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;amp;tid=94264&amp;amp;fromuid=230125"&gt;2&lt;/a&gt;的做法删除了stk,动感终于不会弾了,
但是随之而来的却是veer的电量快速消损,看来我是遇到了传说中的sleep掉电bug了.
于是开始参考煮机网上的机油的各种建议,开始优化,可是效果却还是不太好.
&lt;em&gt;开始技术分析,不想看的机油直接看结论吧,哈哈&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;技术分析&lt;/h2&gt;
&lt;p&gt;在参考各种掉电bug处理的帖子中,其中的一个帖子一位机油提到过, 使用一个工具跟踪sdlterminal发出的wake up事件,给我了灵感.
果断的想去搞清楚wake up事件的来源.
因为正是由于有不断的wake up事件使得veer在待机的时候相关电源管理的进程powerd无法调度veer的内核进入sleep状态.&amp;nbsp;如果知道了这个事件的源头并成功阻止它,那么我们的sleep掉电的问题就会解决了.&lt;/p&gt;
&lt;p&gt;来一个小插曲:在这个时候我打补丁一不小心搞挂了机,于是重新刷机.动感地带还是不断在弹出.非常烦人.
于是我想把这个问题也解决一下而不用去删除stk,就把我gf的sim卡放到我的veer中测试了一下,好像机器又没有弾了.
就开始怀疑我的sim卡可能用太久了有点接触不良于是就只好把stk删除来干掉烦人的动感地带,哈哈,世界又清静了.&amp;nbsp;过了两天,我gf的机子也说不断弾动感地带了,这怎么回事呢.果断帮她处理掉.&lt;/p&gt;
&lt;p&gt;而上面的小插曲又给我灵感了,动感地带弾出不是一种事件吗?它之所以会弹出是因为手机不断在进入网络,所以才会有弹出提示啊.
正常的情况下一次开机第一次弹出就不会再强了.于是为了验证这个想法,果断找来了我的旧wm6手机,插卡开机,不断弹出!&amp;nbsp;ok,好了我终于明白了动感地带弹出信息不是由于stk程序的问题,而是由于不断的进入网络,换言之:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;我的sim卡坏了!导致不断弹出动感地带信息!
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最后,联想我的gf原来好好的不弹出信息却由于我测试后就弹出了,联想我做过的操作,很容易就推导出这样的结论:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;由于我热插拔(没有关机就换)sim卡,导致了sim卡坏了!
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;结论&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;动感地带信息的不断弹出,导致veer不能正常sleep从而导致了sleep&amp;nbsp;bug.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sim卡损坏了,导致动感地带信息的不断弹出.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;在veer中热挺拔sim卡,极容易导致sim卡损坏.&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr /&gt;
&lt;h1&gt;sleep掉电bug的解决方法及验证&lt;/h1&gt;
&lt;p&gt;好了,有了上述的sleep掉电bug的分析,那么解决方法和验证方法都非常明确和简单了:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;到移动营业厅办理换SIM卡(我这里要15元和服务密码),这样就不会有sleep bug了
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;经过我和我gf的这一个多月来的验证,证实了我已经解决了sleep bug,现在飞行模式待机一晚就2%的电量啦.&amp;nbsp;越来越喜欢我的小v了.希望对大家有帮助.谢谢!&lt;/p&gt;
&lt;p&gt;如果有时间,在开学前我会整理一下我的veer&amp;amp;webos的wiki笔记分享给煮机网的各位好机油~谢谢你们.&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;amp;tid=85588&amp;amp;fromuid=230125"&gt;待机突然掉电的真正原因，11月21日针对veer更新！&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;amp;tid=94264&amp;amp;fromuid=230125"&gt;为甚么我的&lt;span class="caps"&gt;VEER&lt;/span&gt;装上动感地带的卡后老是出现“&lt;span class="caps"&gt;SIM&lt;/span&gt;卡服务”的字样&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</summary></entry></feed>