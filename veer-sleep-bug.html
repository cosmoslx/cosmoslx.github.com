<!DOCTYPE html>
<html lang="zh">
<head>
	<title>小v的sleep掉电bug根本原因分析和解决 | A Ordinary Boy, A Marvelous Toy</title>
	<meta charset="utf-8" />
    <meta name="author" content="cosmoslx">
	<link rel="stylesheet" href="http://blog.cosmoslx.me/theme/css/franticworld.css" type="text/css" />
	<link href="http://blog.cosmoslx.me/theme/css/pygments.css" rel="stylesheet">
</head>
<body background="http://blog.cosmoslx.me/theme/img/pattern.png">
		<div class="nav-banner">
		<a href="http://blog.cosmoslx.me">A Ordinary Boy, A Marvelous Toy</a>
		</div>
		
		<div class="content">

<div class="metabox">
	<p class="metaday">035</p>
	<p class="metayear">2012</p>
	<p class="metacategory">Play</p>
</div>
<div class="arcticlecontentbox">
	<div class="articlecontent">
		<a class="articletitle" href="/veer-sleep-bug.html " >小v的sleep掉电bug根本原因分析和解决</a>
		<p>hi~各位机油,龙年快乐啊,从2011年的圣诞的那天开始我拥抱veer,走上webos之路,各位煮机网的机油都给我提供了大量的帮助,现在是我小小贡献的时候了.废话不多说,进入正题.</p>
<!-- more -->

<h1>sleep掉电bug</h1>
<p>简单回顾一下所谓的sleep掉电bug及如何判断是否你的小v有掉电bug呢.</p>
<h2>什么是sleep掉电bug</h2>
<p>回顾一下所谓的<a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;tid=85588&amp;fromuid=230125">sleep掉电bug</a>指的是</p>
<div class="highlight"><pre>webos设备有过待机突然掉电的情况，通过刷机和reboot解决，就是可能有sleep bug，即设备不能正常sleep
</pre></div>


<p>通常如果你的veer充满电并在晚上睡觉时开启飞行模式一般早上起来会消损2%~3%的电,&nbsp;而如果有你的veer消损20%~30%的电量,那么很可能就是掉电bug.</p>
<h2>判断标准及方法</h2>
<p>使用sdlterminal,详细<a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;tid=85588&amp;fromuid=230125">参考</a></p>
<p>1.在preware中安装sdlterminal这个软件；
2.在非充电的状态下运行sdlterminal，单击电源键，15秒后再单击电源键；
3.查看sdlterminal上的powerd信息，正常情况sdlterminal会记录两个时间信息，一个是你第一次按电源键的时间，另一个是第二次按电源键的时间；
4.如果出现很多system go to sleep now 和 system woke up，就说明你的设备存在sleep&nbsp;bug。</p>
<h1>引起sleep掉电bug的原因分析</h1>
<p>有很多相关的帖子分析了掉电bug的原因,有的人认为是硬件的问题,有的人认为是rom的问题,在这里我就不多描述了.&nbsp;这里开始描述一下我发现的sleep掉电的原因的经过.</p>
<p>可能大家开始入手veer的时候而且如果是动感地带的卡的话都会遇到过这样的问题:
<a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;tid=94264&amp;fromuid=230125">为甚么我的<span class="caps">VEER</span>装上动感地带的卡后老是出现“<span class="caps">SIM</span>卡服务”的字样</a>
我和我<span class="caps">GF</span>一起买的veer,她的就不会,而我的就经常弹出,于是按照上面<a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;tid=94264&amp;fromuid=230125">2</a>的做法删除了stk,动感终于不会弾了,
但是随之而来的却是veer的电量快速消损,看来我是遇到了传说中的sleep掉电bug了.
于是开始参考煮机网上的机油的各种建议,开始优化,可是效果却还是不太好.
<em>开始技术分析,不想看的机油直接看结论吧,哈哈</em></p>
<h2>技术分析</h2>
<p>在参考各种掉电bug处理的帖子中,其中的一个帖子一位机油提到过, 使用一个工具跟踪sdlterminal发出的wake up事件,给我了灵感.
果断的想去搞清楚wake up事件的来源.
因为正是由于有不断的wake up事件使得veer在待机的时候相关电源管理的进程powerd无法调度veer的内核进入sleep状态.&nbsp;如果知道了这个事件的源头并成功阻止它,那么我们的sleep掉电的问题就会解决了.</p>
<p>来一个小插曲:在这个时候我打补丁一不小心搞挂了机,于是重新刷机.动感地带还是不断在弹出.非常烦人.
于是我想把这个问题也解决一下而不用去删除stk,就把我gf的sim卡放到我的veer中测试了一下,好像机器又没有弾了.
就开始怀疑我的sim卡可能用太久了有点接触不良于是就只好把stk删除来干掉烦人的动感地带,哈哈,世界又清静了.&nbsp;过了两天,我gf的机子也说不断弾动感地带了,这怎么回事呢.果断帮她处理掉.</p>
<p>而上面的小插曲又给我灵感了,动感地带弾出不是一种事件吗?它之所以会弹出是因为手机不断在进入网络,所以才会有弹出提示啊.
正常的情况下一次开机第一次弹出就不会再强了.于是为了验证这个想法,果断找来了我的旧wm6手机,插卡开机,不断弹出!&nbsp;ok,好了我终于明白了动感地带弹出信息不是由于stk程序的问题,而是由于不断的进入网络,换言之:</p>
<div class="highlight"><pre>我的sim卡坏了!导致不断弹出动感地带信息!
</pre></div>


<p>最后,联想我的gf原来好好的不弹出信息却由于我测试后就弹出了,联想我做过的操作,很容易就推导出这样的结论:</p>
<div class="highlight"><pre>由于我热插拔(没有关机就换)sim卡,导致了sim卡坏了!
</pre></div>


<h2>结论</h2>
<ol>
<li><strong>动感地带信息的不断弹出,导致veer不能正常sleep从而导致了sleep&nbsp;bug.</strong></li>
<li><strong>sim卡损坏了,导致动感地带信息的不断弹出.</strong></li>
<li><strong>在veer中热挺拔sim卡,极容易导致sim卡损坏.</strong></li>
</ol>
<hr />
<h1>sleep掉电bug的解决方法及验证</h1>
<p>好了,有了上述的sleep掉电bug的分析,那么解决方法和验证方法都非常明确和简单了:</p>
<div class="highlight"><pre>到移动营业厅办理换SIM卡(我这里要15元和服务密码),这样就不会有sleep bug了
</pre></div>


<p>经过我和我gf的这一个多月来的验证,证实了我已经解决了sleep bug,现在飞行模式待机一晚就2%的电量啦.&nbsp;越来越喜欢我的小v了.希望对大家有帮助.谢谢!</p>
<p>如果有时间,在开学前我会整理一下我的veer&amp;webos的wiki笔记分享给煮机网的各位好机油~谢谢你们.</p>
<h1>参考</h1>
<ol>
<li><a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;tid=85588&amp;fromuid=230125">待机突然掉电的真正原因，11月21日针对veer更新！</a></li>
<li><a href="http://bbs.zoopda.com/forum.php?mod=viewthread&amp;tid=94264&amp;fromuid=230125">为甚么我的<span class="caps">VEER</span>装上动感地带的卡后老是出现“<span class="caps">SIM</span>卡服务”的字样</a></li>
</ol>
	</div>
	
	       
</div>

		</div>
		
		<div class="sidebar">
<div class="sidebarcategory">
<h4>Categories</h4>
	<li><a href="http://blog.cosmoslx.me/category/life.html">Life</a></li>
	<li><a href="http://blog.cosmoslx.me/category/play.html">Play</a></li>
	<li><a href="http://blog.cosmoslx.me/category/tech.html">Tech</a></li>
</div>

<div class="sidebarpages">
</div>

<div class="sidebarblogroll">
<h4>Blogroll</h4>
    <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
</div>

<div class="sidebarsocial">
<h4>Social</h4>
    <li><a href="http://about.me/cosmoslx">about me</a></li>
    <li><a href="http://github.com/cosmoslx">github</a></li>
</div>		</div>
		
		<footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>,
				Theme by <a href="http://frantic1048.com/">Frantic1048</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>